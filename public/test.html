<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomberman Enhanced Test Suite</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-section {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
        }
        .game-area {
            width: 800px;
            height: 672px;
            border: 3px solid #333;
            margin: 10px auto;
            position: relative;
            background: #2c3e50;
            overflow: hidden;
        }
        .mini-game {
            width: 400px;
            height: 336px;
            border: 2px solid #666;
            margin: 10px auto;
            position: relative;
            background: #34495e;
            overflow: hidden;
        }
        .test-results {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-weight: bold;
            font-size: 12px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.warning { background: #fff3cd; color: #856404; }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        .test-button:hover {
            background: #5a6fd8;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .metric {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border-left: 3px solid #667eea;
        }
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Bomberman Enhanced Test Suite</h1>
        
        <div class="test-grid">
            <div class="test-section">
                <h3>üéÆ Enhanced Game Test</h3>
                <div class="game-area" id="main-game">
                    <!-- Main game test -->
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="fps-display">0</div>
                        <div>FPS</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="entities-display">0</div>
                        <div>Entities</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="bombs-display">0</div>
                        <div>Bombs</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="players-display">0</div>
                        <div>Players</div>
                    </div>
                </div>
                <div class="test-results" id="game-log">
                    Initializing enhanced game test...
                </div>
            </div>
            
            <div class="test-section">
                <h3>üó∫Ô∏è Map System Test</h3>
                <div class="mini-game" id="map-test">
                    <!-- Map system test -->
                </div>
                <div class="test-results" id="map-log">
                    Initializing map system test...
                </div>
                <button class="test-button" onclick="testMapGeneration()">Test Map Generation</button>
                <button class="test-button" onclick="testCollisionDetection()">Test Collision</button>
                <button class="test-button" onclick="testAssetLoading()">Test Assets</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîß Framework Test</h3>
            <div class="test-results" id="framework-log">
                Testing framework components...
            </div>
            <button class="test-button" onclick="testFramework()">Test Framework</button>
            <button class="test-button" onclick="testPerformance()">Test Performance</button>
            <button class="test-button" onclick="testGameLoop()">Test Game Loop</button>
        </div>
        
        <div class="test-section">
            <h3>üéØ Movement System Test</h3>
            <div class="mini-game" id="movement-test">
                <!-- Movement test -->
            </div>
            <div class="test-results" id="movement-log">
                Testing grid-based movement...
            </div>
            <button class="test-button" onclick="testGridMovement()">Test Grid Movement</button>
            <button class="test-button" onclick="testSpriteAnimation()">Test Sprites</button>
            <button class="test-button" onclick="testBombPlacement()">Test Bombs</button>
        </div>
        
        <div class="test-section">
            <h3>üìä Test Results</h3>
            <div id="test-results">
                <div class="status info">All tests pending...</div>
            </div>
        </div>
    </div>

    <!-- Load Framework and Game -->
    <script src="public/js/framework.js"></script>
    <script src="public/js/map.js"></script>
    <script src="public/js/game.js"></script>
    
    <script>
        let mainGame, mapTest, movementTest;
        let testResults = {
            framework: false,
            mapSystem: false,
            movement: false,
            performance: false,
            assets: false
        };

        // Initialize tests
        document.addEventListener('DOMContentLoaded', () => {
            const framework = window.Framework;
            framework.init();
            
            // Initialize main game test
            mainGame = new BombermanGame(document.getElementById('main-game'), {
                send: (data) => {
                    logToElement('game-log', `WebSocket: ${JSON.stringify(data)}`);
                }
            });
            
            // Initialize map test
            mapTest = new MapSystem(document.getElementById('map-test'), framework);
            mapTest.drawMap(0.5);
            
            // Initialize movement test
            movementTest = new BombermanGame(document.getElementById('movement-test'), {
                send: (data) => {
                    logToElement('movement-log', `Movement: ${JSON.stringify(data)}`);
                }
            });
            
            // Start main game
            setTimeout(() => {
                mainGame.start();
                updateMetrics();
            }, 1000);
            
            // Start movement test
            setTimeout(() => {
                movementTest.start();
            }, 2000);
            
            // Run initial tests
            setTimeout(() => {
                testFramework();
                testMapGeneration();
                testGridMovement();
            }, 3000);
        });

        function logToElement(elementId, message) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        function updateMetrics() {
            setInterval(() => {
                const framework = window.Framework;
                document.getElementById('fps-display').textContent = framework.getFPS();
                document.getElementById('entities-display').textContent = framework.entities.size;
                document.getElementById('bombs-display').textContent = mainGame.bombs.size;
                document.getElementById('players-display').textContent = mainGame.players.size;
            }, 1000);
        }

        function testFramework() {
            const framework = window.Framework;
            const results = [];
            
            // Test framework initialization
            if (framework && framework.entities) {
                results.push('‚úÖ Framework initialized');
                testResults.framework = true;
            } else {
                results.push('‚ùå Framework failed to initialize');
            }
            
            // Test game loop
            if (framework.getFPS() > 0) {
                results.push('‚úÖ Game loop running');
            } else {
                results.push('‚ùå Game loop not running');
            }
            
            // Test entity creation
            const testEntity = framework.createGameEntity('test', 0, 0, 32, 32, 'test');
            if (testEntity) {
                results.push('‚úÖ Entity creation working');
                framework.removeEntity('test');
            } else {
                results.push('‚ùå Entity creation failed');
            }
            
            logToElement('framework-log', results.join('\n'));
            updateTestResults();
        }

        function testMapGeneration() {
            const results = [];
            
            // Test map array
            if (mapTest.mapArray && mapTest.mapArray.length > 0) {
                results.push('‚úÖ Map array generated');
                results.push(`‚úÖ Map size: ${mapTest.mapArray[0].length}x${mapTest.mapArray.length}`);
                testResults.mapSystem = true;
            } else {
                results.push('‚ùå Map array generation failed');
            }
            
            // Test starting positions
            const positions = mapTest.getStartingPositions();
            if (positions && positions.length === 4) {
                results.push('‚úÖ Starting positions calculated');
            } else {
                results.push('‚ùå Starting positions failed');
            }
            
            // Test tile rendering
            if (mapTest.container.children.length > 0) {
                results.push('‚úÖ Tiles rendered');
            } else {
                results.push('‚ùå Tile rendering failed');
            }
            
            logToElement('map-log', results.join('\n'));
            updateTestResults();
        }

        function testGridMovement() {
            const results = [];
            
            // Test player creation
            if (movementTest.players.size > 0) {
                results.push('‚úÖ Players created');
            } else {
                results.push('‚ùå Player creation failed');
            }
            
            // Test movement system
            const firstPlayer = movementTest.players.values().next().value;
            if (firstPlayer && firstPlayer.gridX !== undefined) {
                results.push('‚úÖ Grid-based movement system initialized');
                testResults.movement = true;
            } else {
                results.push('‚ùå Grid movement system failed');
            }
            
            // Test collision detection
            if (movementTest.canMove) {
                results.push('‚úÖ Collision detection available');
            } else {
                results.push('‚ùå Collision detection missing');
            }
            
            logToElement('movement-log', results.join('\n'));
            updateTestResults();
        }

        function testCollisionDetection() {
            const results = [];
            
            // Test wall collision
            const testPlayer = { gridX: 0, gridY: 0 };
            const canMoveToWall = movementTest.canMove(testPlayer, -1, 0);
            if (!canMoveToWall) {
                results.push('‚úÖ Wall collision detection working');
            } else {
                results.push('‚ùå Wall collision detection failed');
            }
            
            // Test boundary collision
            const canMoveOutside = movementTest.canMove(testPlayer, 100, 100);
            if (!canMoveOutside) {
                results.push('‚úÖ Boundary collision detection working');
            } else {
                results.push('‚ùå Boundary collision detection failed');
            }
            
            logToElement('map-log', results.join('\n'));
        }

        function testAssetLoading() {
            const results = [];
            
            // Test sprite loading
            const testPlayer = movementTest.players.values().next().value;
            if (testPlayer && testPlayer.sprites) {
                results.push('‚úÖ Player sprites loaded');
                testResults.assets = true;
            } else {
                results.push('‚ùå Player sprites failed to load');
            }
            
            // Test bomb asset
            if (movementTest.bombs.size >= 0) {
                results.push('‚úÖ Bomb system initialized');
            } else {
                results.push('‚ùå Bomb system failed');
            }
            
            logToElement('map-log', results.join('\n'));
            updateTestResults();
        }

        function testPerformance() {
            const results = [];
            const framework = window.Framework;
            
            // Test FPS
            const fps = framework.getFPS();
            if (fps >= 55) {
                results.push(`‚úÖ Performance good: ${fps} FPS`);
                testResults.performance = true;
            } else {
                results.push(`‚ö†Ô∏è Performance low: ${fps} FPS`);
            }
            
            // Test memory usage
            if (framework.entities.size < 100) {
                results.push('‚úÖ Memory usage acceptable');
            } else {
                results.push('‚ö†Ô∏è High entity count');
            }
            
            logToElement('framework-log', results.join('\n'));
            updateTestResults();
        }

        function testGameLoop() {
            const results = [];
            const framework = window.Framework;
            
            // Test game loop state
            if (framework.gameLoopRunning) {
                results.push('‚úÖ Game loop is running');
            } else {
                results.push('‚ùå Game loop not running');
            }
            
            // Test update frequency
            const updateCount = framework.updateCount || 0;
            if (updateCount > 0) {
                results.push(`‚úÖ Updates happening: ${updateCount} updates`);
            } else {
                results.push('‚ùå No updates detected');
            }
            
            logToElement('framework-log', results.join('\n'));
        }

        function testSpriteAnimation() {
            const results = [];
            const firstPlayer = movementTest.players.values().next().value;
            
            if (firstPlayer && firstPlayer.frameIndex !== undefined) {
                results.push('‚úÖ Sprite animation system initialized');
            } else {
                results.push('‚ùå Sprite animation system failed');
            }
            
            if (firstPlayer && firstPlayer.sprites) {
                results.push('‚úÖ Directional sprites loaded');
            } else {
                results.push('‚ùå Directional sprites failed');
            }
            
            logToElement('movement-log', results.join('\n'));
        }

        function testBombPlacement() {
            const results = [];
            
            // Test bomb creation
            const bombCount = movementTest.bombs.size;
            movementTest.placeBomb();
            const newBombCount = movementTest.bombs.size;
            
            if (newBombCount > bombCount) {
                results.push('‚úÖ Bomb placement working');
            } else {
                results.push('‚ùå Bomb placement failed');
            }
            
            // Test bomb timer
            const bomb = movementTest.bombs.values().next().value;
            if (bomb && bomb.timer === 2000) {
                results.push('‚úÖ Bomb timer set correctly (2 seconds)');
            } else {
                results.push('‚ùå Bomb timer incorrect');
            }
            
            logToElement('movement-log', results.join('\n'));
        }

        function updateTestResults() {
            const passed = Object.values(testResults).filter(Boolean).length;
            const total = Object.keys(testResults).length;
            const percentage = Math.round((passed / total) * 100);
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `
                <div class="status ${percentage === 100 ? 'success' : percentage >= 80 ? 'info' : 'warning'}">
                    Test Results: ${passed}/${total} tests passed (${percentage}%)
                </div>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value">${testResults.framework ? '‚úÖ' : '‚ùå'}</div>
                        <div>Framework</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${testResults.mapSystem ? '‚úÖ' : '‚ùå'}</div>
                        <div>Map System</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${testResults.movement ? '‚úÖ' : '‚ùå'}</div>
                        <div>Movement</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${testResults.performance ? '‚úÖ' : '‚ùå'}</div>
                        <div>Performance</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${testResults.assets ? '‚úÖ' : '‚ùå'}</div>
                        <div>Assets</div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html> 